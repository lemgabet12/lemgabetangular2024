"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8326],{8326:(C,m,h)=>{h.r(m),h.d(m,{LoginPageModule:()=>P});var f=h(4755),g=h(5030),u=h(626),p=h(2443),d=h(5861);class l{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(s,n=!1){return this.onePassHasher.start().appendStr(s).end(n)}static hashAsciiStr(s,n=!1){return this.onePassHasher.start().appendAsciiStr(s).end(n)}static _hex(s){const n=l.hexChars,t=l.hexOut;let e,o,r,c;for(c=0;c<4;c+=1)for(o=8*c,e=s[c],r=0;r<8;r+=2)t[o+1+r]=n.charAt(15&e),e>>>=4,t[o+0+r]=n.charAt(15&e),e>>>=4;return t.join("")}static _md5cycle(s,n){let t=s[0],e=s[1],o=s[2],r=s[3];t+=(e&o|~e&r)+n[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&o)+n[1]-389564586|0,r=(r<<12|r>>>20)+t|0,o+=(r&t|~r&e)+n[2]+606105819|0,o=(o<<17|o>>>15)+r|0,e+=(o&r|~o&t)+n[3]-1044525330|0,e=(e<<22|e>>>10)+o|0,t+=(e&o|~e&r)+n[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&o)+n[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,o+=(r&t|~r&e)+n[6]-1473231341|0,o=(o<<17|o>>>15)+r|0,e+=(o&r|~o&t)+n[7]-45705983|0,e=(e<<22|e>>>10)+o|0,t+=(e&o|~e&r)+n[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&o)+n[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,o+=(r&t|~r&e)+n[10]-42063|0,o=(o<<17|o>>>15)+r|0,e+=(o&r|~o&t)+n[11]-1990404162|0,e=(e<<22|e>>>10)+o|0,t+=(e&o|~e&r)+n[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&o)+n[13]-40341101|0,r=(r<<12|r>>>20)+t|0,o+=(r&t|~r&e)+n[14]-1502002290|0,o=(o<<17|o>>>15)+r|0,e+=(o&r|~o&t)+n[15]+1236535329|0,e=(e<<22|e>>>10)+o|0,t+=(e&r|o&~r)+n[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&o|e&~o)+n[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,o+=(r&e|t&~e)+n[11]+643717713|0,o=(o<<14|o>>>18)+r|0,e+=(o&t|r&~t)+n[0]-373897302|0,e=(e<<20|e>>>12)+o|0,t+=(e&r|o&~r)+n[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&o|e&~o)+n[10]+38016083|0,r=(r<<9|r>>>23)+t|0,o+=(r&e|t&~e)+n[15]-660478335|0,o=(o<<14|o>>>18)+r|0,e+=(o&t|r&~t)+n[4]-405537848|0,e=(e<<20|e>>>12)+o|0,t+=(e&r|o&~r)+n[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&o|e&~o)+n[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,o+=(r&e|t&~e)+n[3]-187363961|0,o=(o<<14|o>>>18)+r|0,e+=(o&t|r&~t)+n[8]+1163531501|0,e=(e<<20|e>>>12)+o|0,t+=(e&r|o&~r)+n[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&o|e&~o)+n[2]-51403784|0,r=(r<<9|r>>>23)+t|0,o+=(r&e|t&~e)+n[7]+1735328473|0,o=(o<<14|o>>>18)+r|0,e+=(o&t|r&~t)+n[12]-1926607734|0,e=(e<<20|e>>>12)+o|0,t+=(e^o^r)+n[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^o)+n[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,o+=(r^t^e)+n[11]+1839030562|0,o=(o<<16|o>>>16)+r|0,e+=(o^r^t)+n[14]-35309556|0,e=(e<<23|e>>>9)+o|0,t+=(e^o^r)+n[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^o)+n[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,o+=(r^t^e)+n[7]-155497632|0,o=(o<<16|o>>>16)+r|0,e+=(o^r^t)+n[10]-1094730640|0,e=(e<<23|e>>>9)+o|0,t+=(e^o^r)+n[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^o)+n[0]-358537222|0,r=(r<<11|r>>>21)+t|0,o+=(r^t^e)+n[3]-722521979|0,o=(o<<16|o>>>16)+r|0,e+=(o^r^t)+n[6]+76029189|0,e=(e<<23|e>>>9)+o|0,t+=(e^o^r)+n[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^o)+n[12]-421815835|0,r=(r<<11|r>>>21)+t|0,o+=(r^t^e)+n[15]+530742520|0,o=(o<<16|o>>>16)+r|0,e+=(o^r^t)+n[2]-995338651|0,e=(e<<23|e>>>9)+o|0,t+=(o^(e|~r))+n[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~o))+n[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,o+=(t^(r|~e))+n[14]-1416354905|0,o=(o<<15|o>>>17)+r|0,e+=(r^(o|~t))+n[5]-57434055|0,e=(e<<21|e>>>11)+o|0,t+=(o^(e|~r))+n[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~o))+n[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,o+=(t^(r|~e))+n[10]-1051523|0,o=(o<<15|o>>>17)+r|0,e+=(r^(o|~t))+n[1]-2054922799|0,e=(e<<21|e>>>11)+o|0,t+=(o^(e|~r))+n[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~o))+n[15]-30611744|0,r=(r<<10|r>>>22)+t|0,o+=(t^(r|~e))+n[6]-1560198380|0,o=(o<<15|o>>>17)+r|0,e+=(r^(o|~t))+n[13]+1309151649|0,e=(e<<21|e>>>11)+o|0,t+=(o^(e|~r))+n[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~o))+n[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,o+=(t^(r|~e))+n[2]+718787259|0,o=(o<<15|o>>>17)+r|0,e+=(r^(o|~t))+n[9]-343485551|0,e=(e<<21|e>>>11)+o|0,s[0]=t+s[0]|0,s[1]=e+s[1]|0,s[2]=o+s[2]|0,s[3]=r+s[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(l.stateIdentity),this}appendStr(s){const n=this._buffer8,t=this._buffer32;let o,r,e=this._bufferLength;for(r=0;r<s.length;r+=1){if(o=s.charCodeAt(r),o<128)n[e++]=o;else if(o<2048)n[e++]=192+(o>>>6),n[e++]=63&o|128;else if(o<55296||o>56319)n[e++]=224+(o>>>12),n[e++]=o>>>6&63|128,n[e++]=63&o|128;else{if(o=1024*(o-55296)+(s.charCodeAt(++r)-56320)+65536,o>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");n[e++]=240+(o>>>18),n[e++]=o>>>12&63|128,n[e++]=o>>>6&63|128,n[e++]=63&o|128}e>=64&&(this._dataLength+=64,l._md5cycle(this._state,t),e-=64,t[0]=t[16])}return this._bufferLength=e,this}appendAsciiStr(s){const n=this._buffer8,t=this._buffer32;let o,e=this._bufferLength,r=0;for(;;){for(o=Math.min(s.length-r,64-e);o--;)n[e++]=s.charCodeAt(r++);if(e<64)break;this._dataLength+=64,l._md5cycle(this._state,t),e=0}return this._bufferLength=e,this}appendByteArray(s){const n=this._buffer8,t=this._buffer32;let o,e=this._bufferLength,r=0;for(;;){for(o=Math.min(s.length-r,64-e);o--;)n[e++]=s[r++];if(e<64)break;this._dataLength+=64,l._md5cycle(this._state,t),e=0}return this._bufferLength=e,this}getState(){const s=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[s[0],s[1],s[2],s[3]]}}setState(s){const n=s.buffer,t=s.state,e=this._state;let o;for(this._dataLength=s.length,this._bufferLength=s.buflen,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],o=0;o<n.length;o+=1)this._buffer8[o]=n.charCodeAt(o)}end(s=!1){const n=this._bufferLength,t=this._buffer8,e=this._buffer32,o=1+(n>>2);this._dataLength+=n;const r=8*this._dataLength;if(t[n]=128,t[n+1]=t[n+2]=t[n+3]=0,e.set(l.buffer32Identity.subarray(o),o),n>55&&(l._md5cycle(this._state,e),e.set(l.buffer32Identity)),r<=4294967295)e[14]=r;else{const c=r.toString(16).match(/(.*?)(.{0,8})$/);if(null===c)return;const b=parseInt(c[2],16),x=parseInt(c[1],16)||0;e[14]=b,e[15]=x}return l._md5cycle(this._state,e),s?this._state:l._hex(this._state)}}if(l.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),l.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),l.hexChars="0123456789abcdef",l.hexOut=[],l.onePassHasher=new l,"5d41402abc4b2a76b9719d911017c592"!==l.hashStr("hello"))throw new Error("Md5 self test failed.");var i=h(3020),_=h(3144),y=h(849);function v(a,s){if(1&a&&(i.TgZ(0,"div",21),i._uU(1),i.qZA()),2&a){const n=i.oxw();i.xp6(1),i.Oqu(n.errorMessage)}}function w(a,s){if(1&a&&(i.TgZ(0,"ion-select-option",22),i._uU(1),i.qZA()),2&a){const n=s.$implicit;i.Q6J("value",n.name),i.xp6(1),i.hij(" ",n.name," ")}}const L=[{path:"",component:(()=>{class a{constructor(n,t,e){this.router=n,this.http=t,this.storage=e,this.emailOrTelephone="",this.password="",this.selectedHotel="",this.errorMessage="",this.attempts=0,this.lockedOut=!1,this.countdownMinutes=0,this.countdownSeconds=0,this.lockedOutUntil=null,this.passwordVisible=!1,this.passwordFieldType="password",this.serverUrl="",this.port="",this.hotels=[]}ngOnInit(){var n=this;return(0,d.Z)(function*(){yield n.storage.create(),n.loadConfig(),n.checkLockoutStatus(),n.checkIfAlreadyLoggedIn(),n.fetchHotels()})()}checkIfAlreadyLoggedIn(){"true"===localStorage.getItem("isLoggedIn")&&this.router.navigate(["/menu/home"])}loadConfig(){var n=this;return(0,d.Z)(function*(){n.serverUrl=localStorage.getItem("serverUrl")||"http://default-url",n.port=localStorage.getItem("port")||"default-port"})()}checkLockoutStatus(){const n=localStorage.getItem("lockedOutUntil");n&&(this.lockedOutUntil=new Date(n),this.lockedOutUntil>new Date?(this.lockedOut=!0,this.startCountdown()):(localStorage.removeItem("lockedOutUntil"),this.lockedOutUntil=null))}fetchHotels(){this.http.get(`${this.serverUrl}:${this.port}/hotel/getConfigHotel`).subscribe(n=>{this.hotels=n})}onHotelChange(){const n=this.hotels.find(t=>t.name===this.selectedHotel);n&&(localStorage.setItem("hotelport",n.hotelport),localStorage.setItem("urlpub",n.urlpub))}login(){var n=this;return(0,d.Z)(function*(){if("sup"===n.emailOrTelephone&&"arabsoft123"===n.password)return void n.router.navigate(["/config"]);if(n.lockedOut)return;if(!n.emailOrTelephone||!n.password||!n.selectedHotel)return void(n.errorMessage="Tous les champs sont requis.");const t=n.encryptPassword(n.password);try{const e=`${n.serverUrl}:${n.port}/api/usersmob/login`,o={emailOrTelephone:n.emailOrTelephone,password:t},r=yield n.http.post(e,o).toPromise();if(r&&r.user){const c=r.user;localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",c),n.router.navigate(["/menu/home"])}else n.handleLoginFailure()}catch(e){console.error("Erreur lors de la connexion :",e),n.errorMessage="Erreur de connexion au serveur. Veuillez r\xe9essayer plus tard."}})()}encryptPassword(n){return l.hashStr(n).toString()}togglePasswordVisibility(){this.passwordVisible=!this.passwordVisible,this.passwordFieldType=this.passwordVisible?"text":"password"}startCountdown(){this.interval=setInterval(()=>{const n=new Date;if(this.lockedOutUntil&&this.lockedOutUntil>n){const t=Math.ceil((this.lockedOutUntil.getTime()-n.getTime())/1e3);this.countdownMinutes=Math.floor(t/60),this.countdownSeconds=t%60}else clearInterval(this.interval),this.lockedOut=!1,this.attempts=0,localStorage.removeItem("lockedOutUntil"),this.lockedOutUntil=null},1e3)}ngOnDestroy(){this.interval&&clearInterval(this.interval)}handleLoginFailure(){this.errorMessage="Identifiants invalides. Veuillez r\xe9essayer.",this.attempts++,this.saveAuthTry("failure"),this.attempts>=3&&(this.lockedOutUntil=new Date((new Date).getTime()+6e5),localStorage.setItem("lockedOutUntil",this.lockedOutUntil.toISOString()),this.lockedOut=!0,this.startCountdown())}saveAuthTry(n){var t=this;return(0,d.Z)(function*(){try{const e=t.formatDateWithTime(new Date),o={login:t.emailOrTelephone,etat:n,datetry:e};yield t.http.post(`${t.serverUrl}:${t.port}/api/authtry`,o).toPromise()}catch(e){console.error("Error saving authtry:",e)}})()}formatDateWithTime(n){return`${n.getFullYear()}/${("0"+(n.getMonth()+1)).slice(-2)}/${("0"+n.getDate()).slice(-2)} ${("0"+n.getHours()).slice(-2)}:${("0"+n.getMinutes()).slice(-2)}:${("0"+n.getSeconds()).slice(-2)}`}navigateToInitialTab(n){var t=this;return(0,d.Z)(function*(){try{const o=(yield t.http.get(`${t.serverUrl}:${t.port}/api/module/user/${n}`).toPromise()).map(c=>({name:c.name,icon:c.icon,url:c.url}));t.router.navigate([o.length>0?o[0].url:"/menu/home"],{queryParams:{id:n},replaceUrl:!0})}catch(e){console.error("Error fetching user data:",e),t.errorMessage="Error fetching user data. Please try again later."}})()}navigateToRegister(){this.router.navigate(["/register"])}navigateToResetPassword(){const n=localStorage.getItem("userId")||"";this.router.navigate(["/reset-password"],{queryParams:{id:n}})}}return a.\u0275fac=function(n){return new(n||a)(i.Y36(p.F0),i.Y36(_.eN),i.Y36(y.K))},a.\u0275cmp=i.Xpm({type:a,selectors:[["app-login"]],decls:28,vars:7,consts:[[1,"login-background"],[1,"overlay"],[1,"login-container"],[1,"login-card"],[1,"logo-container","text-center","mb-4"],["src","../../assets/images/xliaarab.png","width","100","alt","Logo"],[3,"ngSubmit"],["class","text-danger mb-3",4,"ngIf"],[1,"form-group","mb-3"],["for","emailOrTelephone"],["type","text","id","emailOrTelephone","required","","name","emailOrTelephone",3,"ngModel","ngModelChange"],["for","password"],[1,"input-group"],["id","password","required","","name","password",3,"type","ngModel","ngModelChange"],["fill","clear",3,"click"],[3,"name"],["for","hotel"],["name","hotel","id","hotel",3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["expand","block","color","primary","type","submit"],["type","button","expand","block","color","light",2,"overflow-x","auto",3,"click"],[1,"text-danger","mb-3"],[3,"value"]],template:function(n,t){1&n&&(i.TgZ(0,"ion-content",0),i._UZ(1,"div",1),i.TgZ(2,"div",2)(3,"div",3)(4,"div",4),i._UZ(5,"img",5),i.qZA(),i.TgZ(6,"form",6),i.NdJ("ngSubmit",function(){return t.login()}),i.YNc(7,v,2,1,"div",7),i.TgZ(8,"div",8)(9,"ion-label",9),i._uU(10,"Email/T\xe9l\xe9phone"),i.qZA(),i.TgZ(11,"ion-input",10),i.NdJ("ngModelChange",function(o){return t.emailOrTelephone=o}),i.qZA()(),i.TgZ(12,"div",8)(13,"ion-label",11),i._uU(14,"Mot de passe"),i.qZA(),i.TgZ(15,"div",12)(16,"ion-input",13),i.NdJ("ngModelChange",function(o){return t.password=o}),i.qZA(),i.TgZ(17,"ion-button",14),i.NdJ("click",function(){return t.togglePasswordVisibility()}),i._UZ(18,"ion-icon",15),i.qZA()()(),i.TgZ(19,"div",8)(20,"ion-label",16),i._uU(21,"S\xe9lectionnez votre h\xf4tel"),i.qZA(),i.TgZ(22,"ion-select",17),i.NdJ("ngModelChange",function(o){return t.selectedHotel=o})("ionChange",function(){return t.onHotelChange()}),i.YNc(23,w,2,2,"ion-select-option",18),i.qZA()(),i.TgZ(24,"ion-button",19),i._uU(25,"Se connecter"),i.qZA(),i.TgZ(26,"ion-button",20),i.NdJ("click",function(){return t.navigateToRegister()}),i._uU(27," Inscription "),i.qZA()()()()()),2&n&&(i.xp6(7),i.Q6J("ngIf",t.errorMessage),i.xp6(4),i.Q6J("ngModel",t.emailOrTelephone),i.xp6(5),i.Q6J("type",t.passwordFieldType)("ngModel",t.password),i.xp6(2),i.Q6J("name",t.passwordVisible?"eye":"eye-off"),i.xp6(4),i.Q6J("ngModel",t.selectedHotel),i.xp6(1),i.Q6J("ngForOf",t.hotels))},dependencies:[f.sg,f.O5,g._Y,g.JJ,g.JL,g.Q7,g.On,g.F,u.YG,u.W2,u.gu,u.pK,u.Q$,u.t9,u.n0,u.QI,u.j9],styles:[".login-background[_ngcontent-%COMP%]{--background: url(cover.711d04df7493f8aa.png) no-repeat center center / cover;position:relative;height:100%}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;z-index:1}.login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;z-index:2;position:relative}.login-card[_ngcontent-%COMP%]{background:#ffffff;border-radius:10px;box-shadow:0 4px 8px #0000001a;width:100%;max-width:400px;padding:2rem}.logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;border-radius:50%;box-shadow:0 4px 8px #0000001a}.text-danger[_ngcontent-%COMP%]{color:red}.mb-3[_ngcontent-%COMP%]{margin-bottom:1rem}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center}.input-group-append[_ngcontent-%COMP%]{margin-left:-40px;color:#000;z-index:2}ion-button[_ngcontent-%COMP%]{margin-top:1rem;--background: #dd7520;border-radius:5px;--box-shadow: 0 4px 8px rgba(0, 0, 0, .1)}ion-button[color=light][_ngcontent-%COMP%]{--background: #ffffff;--color: #df15a2}ion-button[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}.form-label[_ngcontent-%COMP%]{font-weight:700;color:#000}"]}),a})()}];let T=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=i.oAB({type:a}),a.\u0275inj=i.cJS({imports:[p.Bz.forChild(L),p.Bz]}),a})();var O=h(183);let P=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=i.oAB({type:a}),a.\u0275inj=i.cJS({imports:[f.ez,g.u5,u.Pc,T,g.UX,O.Fw.forRoot()]}),a})()}}]);