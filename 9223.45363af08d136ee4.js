"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9223],{9223:(R,_,s)=>{s.r(_),s.d(_,{RecaptilatifPageModule:()=>A});var u=s(4755),h=s(5030),c=s(626),m=s(2443),f=s(5861),b=s(8053),t=s(3020),M=s(3144),C=s(849);function y(o,g){if(1&o){const e=t.EpF();t.TgZ(0,"ion-datetime",31),t.NdJ("ngModelChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.startDate=a)})("ionChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.fetchData())}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("ngModel",e.startDate)}}function Z(o,g){if(1&o){const e=t.EpF();t.TgZ(0,"ion-datetime",31),t.NdJ("ngModelChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.endDate=a)})("ionChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.fetchData())}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("ngModel",e.endDate)}}function D(o,g){if(1&o){const e=t.EpF();t.TgZ(0,"tr",32),t.NdJ("click",function(){const r=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.openRowDetails(r.caisseid,r.labelle,r.TO))}),t.TgZ(1,"td",33),t._uU(2),t.qZA(),t.TgZ(3,"td",34),t._uU(4),t.qZA(),t.TgZ(5,"td",34),t._uU(6),t.qZA(),t.TgZ(7,"td",34),t._uU(8),t.qZA(),t.TgZ(9,"td",34),t._uU(10),t.qZA(),t.TgZ(11,"td",34),t._uU(12),t.qZA()()}if(2&o){const e=g.$implicit;t.xp6(2),t.Oqu(e.labelle),t.xp6(2),t.Oqu(0===e.integervalue4?null:e.integervalue4),t.xp6(2),t.Oqu(0===e.integervalue3?null:e.integervalue3),t.xp6(2),t.Oqu(0===e.integervalue2?null:e.integervalue2),t.xp6(2),t.Oqu(0===e.integervalue1?null:e.integervalue1),t.xp6(2),t.Oqu(0===e.TO?null:e.TO)}}const O=[{path:"",component:(()=>{class o{RefreshProcedure(){throw new Error("Method not implemented.")}constructor(e,n,a,r){this.http=e,this.router=n,this.storage=a,this.cdr=r,this.currentDate=new Date,this.rows=[],this.headers=[],this.serverUrl="",this.startDate="",this.endDate="",this.formtdstart="",this.formtdend="",this.isStartDatePickerOpen=!1,this.isEndDatePickerOpen=!1,this.baseUrl="",this.adrese="",this.port="",this.storage.create()}doRefresh(e){}loadConfig(){var e=this;return(0,f.Z)(function*(){e.serverUrl=localStorage.getItem("urlpub")||"http://default-url",e.port=localStorage.getItem("hotelport")||"default-port"})()}ngOnInit(){var e=this;return(0,f.Z)(function*(){yield e.loadConfig(),e.startDate=localStorage.getItem("startDate")||(new Date).toISOString().split("T")[0],e.endDate=localStorage.getItem("endDate")||(new Date).toISOString().split("T")[0],yield e.retrieveSettings(),e.fetchData()})()}toggleStartDatePicker(){this.isStartDatePickerOpen=!this.isStartDatePickerOpen,this.isEndDatePickerOpen=!1}toggleEndDatePicker(){this.isEndDatePickerOpen=!this.isEndDatePickerOpen,this.isStartDatePickerOpen=!1}retrieveSettings(){var e=this;return(0,f.Z)(function*(){e.baseUrl=`${e.serverUrl}:${e.port}/hotel`})()}formatDateForService(e){const n=e.split("-");if(3!==n.length)throw new Error("Invalid date format. Expected yyyy-MM-dd");return`${n[2]}/${n[1]}/${n[0]}`}fetchData(){var e=this;return(0,f.Z)(function*(){const n=e.formatDateForService(e.startDate);console.log(n),e.formtdstart=n;const a=e.formatDateForService(e.endDate);console.log(a),e.formtdend=a;const r=localStorage.getItem("sessionId")||"";e.http.get(`${e.baseUrl}/PV_LIST_AR`,{params:{p_startDate:e.formtdstart,p_endDate:e.formtdend,session_id_:r},responseType:"json"}).subscribe(d=>{Array.isArray(d)&&(e.rows=d.map(i=>({...i,integervalue5:Math.floor(i.aut),integervalue4:Math.floor(i.espe),integervalue3:Math.floor(i.cheq),integervalue2:Math.floor(i.cart),integervalue1:Math.floor(i.aut),TO:Math.floor(i.ca)})));const p=localStorage.getItem("sessionId");e.http.get(`${e.baseUrl}/getlistpv/${p}`,{responseType:"json"}).subscribe(i=>{console.log("items:",i),e.rows=Array.isArray(i)&&i.length>0?i.map(l=>({...l,integervalue5:Math.floor(l.aut),integervalue4:Math.floor(l.espe),integervalue3:Math.floor(l.cheq),integervalue2:Math.floor(l.cart),integervalue1:Math.floor(l.aut),TO:Math.floor(l.ca)})):[],e.createChart1(),e.createChart2()},i=>{console.error("Failed to fetch data from /getlistpv:",i)})},d=>{console.error("Failed to fetch data from /PV_LIST_AR:",d)}),e.cdr.detectChanges()})()}onDateChange(){var e=this;return(0,f.Z)(function*(){localStorage.setItem("startDate",e.startDate),localStorage.setItem("endDate",e.endDate),e.fetchData()})()}createChart1(){var e=this;return(0,f.Z)(function*(){try{const n=localStorage.getItem("sessionId"),a=yield e.http.get(`${e.baseUrl}/getmaxarticle/${n}`).toPromise();if(!a||a.length<3)return console.error("Insufficient data to display top 3 items"),void(e.chart1&&(e.chart1.destroy(),e.chart1=null));e.chart1&&e.chart1.destroy(),a.sort((l,x)=>x.qte-l.qte);const r=a.slice(0,3),d=r.map(l=>l.labelle),p=r.map(l=>l.qte),i=document.getElementById("chart1");if(i){const l=i.getContext("2d");l&&(e.chart1=new b.ZP(l,{type:"bar",data:{labels:d,datasets:[{label:"Meilleur article vendu",data:p,backgroundColor:["#36A2EB","#36A2EB","#36A2EB"],borderColor:["#36A2EB","#36A2EB","#36A2EB"],borderWidth:2,hoverBackgroundColor:["#FF6F91","#3A99D8","#FFD700"]}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Articles",font:{size:14,weight:"bold"}},ticks:{font:{size:12},autoSkip:!1,maxRotation:45,minRotation:45}},y:{title:{display:!0,text:"Quantit\xe9",font:{size:14,weight:"bold"}},beginAtZero:!0,ticks:{font:{size:12},stepSize:1}}},plugins:{tooltip:{callbacks:{label:v=>`Quantity: ${v.raw}`},backgroundColor:"#444",titleFont:{size:14,weight:"bold"},bodyFont:{size:12},cornerRadius:5},legend:{display:!0,labels:{font:{size:14,weight:"bold"}}}},onClick:(v,P)=>{P.length>0&&console.log(`Selected Article: ${d[P[0].index]}`)}}}))}}catch(n){console.error("Error fetching data:",n)}})()}createChart2(){var e=this;return(0,f.Z)(function*(){const n=localStorage.getItem("sessionId");e.http.get(`${e.baseUrl}/getlistpv/${n}`).subscribe(a=>{if(e.chart2&&e.chart2.destroy(),a){a.sort((i,l)=>l.ca-i.ca);const r=a.slice(0,3);e.chart2=new b.ZP("chart2",{type:"bar",data:{labels:[r[0].labelle,r[1].labelle,r[2].labelle],datasets:[{label:"Point De Vente",data:[r[0].ca,r[1].ca,r[2].ca],backgroundColor:["#FA7000","#FA7000","#FA7000"],barPercentage:.6}]},options:{}})}},a=>{console.error("Error fetching data:",a)})})()}openRowDetails(e,n,a){this.startDate&&this.endDate?(localStorage.setItem("startDate",this.startDate),localStorage.setItem("endDate",this.endDate)):console.error("Start date or end date is missing."),this.router.navigate(["/deteilrecap",e,{labelle:n,TO:a}])}ngOnDestroy(){localStorage.removeItem("startDate"),localStorage.removeItem("endDate")}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(M.eN),t.Y36(m.F0),t.Y36(C.K),t.Y36(t.sBO))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-recaptilatif"]],decls:58,vars:9,consts:[[1,"ion-no-border"],[2,"text-align","center"],["slot","end",2,"display","flex","justify-content","center","align-items","center"],[2,"display","flex","justify-content","center","align-items","center","color","black","font-family","'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif","margin","6%"],["slot","end"],[1,"refresh-button",3,"click"],["loading","lazy","src","../../../assets/icon/arrows-rotate-solid.svg","alt","refresh"],[2,"text-align","center","margin","4px"],[1,"table-title","text-center","bg-white","text-dark","mt-3",2,"font-size","20px","color","black"],[2,"display","flex","align-items","center","justify-content","center"],[2,"margin-right","3px","display","flex","flex-direction","column","align-items","center"],["name","calendar",1,"calendar-icon",3,"click"],["type","text","placeholder","Start Date","readonly","",1,"input-sm",3,"value"],["displayFormat","dd/MM/yyyy",3,"ngModel","ngModelChange","ionChange",4,"ngIf"],[2,"margin-right","3px"],[2,"line-height","35px","font-size","16px"],[2,"display","flex","flex-direction","column","align-items","center"],["type","text","placeholder","End Date","readonly","",1,"input-sm",3,"value"],[1,"data-grid"],["sclass","table-title text-center bg-white text-dark mt-3",2,"font-size","20px"],[2,"width","100%","color","black","overflow-x","auto"],[2,"text-align","center","font-size","10px"],["colspan","5",2,"text-align","center","font-size","10px"],[1,"data-header"],[2,"font-size","10px","color","black"],[3,"click",4,"ngFor","ngForOf"],[2,"overflow-x","auto","text-align","center"],[2,"overflow-x","auto"],["id","chart1",2,"overflow-x","auto","height","200px"],[2,"text-align","center","font-size","20px"],["id","chart2",2,"overflow-x","auto","height","200px"],["displayFormat","dd/MM/yyyy",3,"ngModel","ngModelChange","ionChange"],[3,"click"],[2,"font-size","10px","text-align","left"],[2,"font-size","10px","text-align","right"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar"),t._UZ(2,"ion-title",1),t.TgZ(3,"ion-buttons",2)(4,"p",3),t._uU(5),t.ALo(6,"date"),t.qZA()(),t.TgZ(7,"ion-buttons",4)(8,"ion-button",5),t.NdJ("click",function(){return n.RefreshProcedure()}),t._UZ(9,"img",6),t.qZA()()()(),t.TgZ(10,"ion-content")(11,"div",7)(12,"h2",8),t._uU(13,"S\xe9lectionner la p\xe9riode :"),t.qZA(),t.TgZ(14,"div",9)(15,"div",10)(16,"ion-icon",11),t.NdJ("click",function(){return n.toggleStartDatePicker()}),t.qZA(),t._UZ(17,"ion-input",12),t.YNc(18,y,1,1,"ion-datetime",13),t.qZA(),t.TgZ(19,"div",14)(20,"span",15),t._uU(21,"Au"),t.qZA()(),t.TgZ(22,"div",16)(23,"ion-icon",11),t.NdJ("click",function(){return n.toggleEndDatePicker()}),t.qZA(),t._UZ(24,"ion-input",17),t.YNc(25,Z,1,1,"ion-datetime",13),t.qZA()(),t.TgZ(26,"ion-grid",18)(27,"h2",19),t._uU(28,"Points de vente"),t.qZA(),t.TgZ(29,"table",20)(30,"thead")(31,"tr")(32,"th",21),t._uU(33,"Labelle"),t.qZA(),t.TgZ(34,"th",22),t._uU(35,"DT"),t.qZA()()(),t.TgZ(36,"tbody")(37,"tr",23)(38,"th",24),t._uU(39,"P.V"),t.qZA(),t.TgZ(40,"th",24),t._uU(41,"ESPE"),t.qZA(),t.TgZ(42,"th",24),t._uU(43,"CHEQ"),t.qZA(),t.TgZ(44,"th",24),t._uU(45,"CART"),t.qZA(),t.TgZ(46,"th",24),t._uU(47,"AUT"),t.qZA(),t.TgZ(48,"th",24),t._uU(49,"CA"),t.qZA()(),t.YNc(50,D,13,6,"tr",25),t.qZA()()()(),t.TgZ(51,"div",26)(52,"ion-card",27),t._UZ(53,"canvas",28),t.qZA()(),t._UZ(54,"h3",29),t.TgZ(55,"div",26)(56,"ion-card",27),t._UZ(57,"canvas",30),t.qZA()()()),2&e&&(t.xp6(5),t.hij(" ",t.xi3(6,6,n.currentDate,"dd/MM/yyyy")," "),t.xp6(12),t.Q6J("value",n.formtdstart),t.xp6(1),t.Q6J("ngIf",n.isStartDatePickerOpen),t.xp6(6),t.Q6J("value",n.formtdend),t.xp6(1),t.Q6J("ngIf",n.isEndDatePickerOpen),t.xp6(25),t.Q6J("ngForOf",n.rows))},dependencies:[u.sg,u.O5,h.JJ,h.On,c.YG,c.Sm,c.PM,c.W2,c.x4,c.jY,c.Gu,c.gu,c.pK,c.wd,c.sr,c.QI,c.j9,u.uU],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: white}@media (prefers-color-scheme: dark){ion-toolbar[_ngcontent-%COMP%]{--background: var(--ion-background-color)}}.md[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--padding-top: var(--status-bar-height)}ion-title[_ngcontent-%COMP%]{font-size:20px;font-family:WorkSans-Bold;color:var(--color-darkText)}.date-pickers[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:16px}.chart-container[_ngcontent-%COMP%]{position:relative;margin:20px auto;height:400px;width:80%}ion-title.md[_ngcontent-%COMP%]{text-align:center;margin-left:48px}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.data-grid[_ngcontent-%COMP%]{width:100%}.data-header[_ngcontent-%COMP%]{background-color:#23272c;color:#fff;font-weight:700;border-bottom:2px solid #282e35}.data-header-cell[_ngcontent-%COMP%], .data-cell[_ngcontent-%COMP%]{padding:12px;text-align:center}.data-cell[_ngcontent-%COMP%]{border-bottom:1px solid #ccc}.data-row[_ngcontent-%COMP%]:nth-child(even){background-color:#f8f9fa}.data-row[_ngcontent-%COMP%]:hover{background-color:#e9ecef}table[_ngcontent-%COMP%]{border-collapse:collapse;border-spacing:0;width:100%;border:1px solid #ddd;background-color:#fffc}.refrech-button[_ngcontent-%COMP%]{--background: white}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:left;padding:4px;border:1px solid #ddd;font-size:11px}th[_ngcontent-%COMP%]{background-color:#f2f2f2;font-size:9px}.table-title[_ngcontent-%COMP%]{text-align:center;margin-top:20px;font-size:1.5em;color:#fff}.table-description[_ngcontent-%COMP%]{text-align:left;font-size:1em;color:#eee}tr[_ngcontent-%COMP%]:nth-child(even){background-color:#f2f2f2}.custom-datetime[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 16px;--border-radius: 8px;--background: #f7f7f7;--color: #333;font-weight:700}.calendar-icon[_ngcontent-%COMP%]{font-size:24px;color:#ebb625;cursor:pointer}.calendar-icon[_ngcontent-%COMP%]:hover{color:#dd9932}.table-container[_ngcontent-%COMP%]{box-shadow:0 2px 5px #0000001a;border-radius:8px;background-color:#fff;padding:20px}.input-daterange[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin:10px 0}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-right:10px}.input-group-addon[_ngcontent-%COMP%]{background-color:#f0f0f0;border:1px solid #ddd;border-radius:4px;padding:5px}.calendar-icon[_ngcontent-%COMP%]{font-size:20px}.fetch-button[_ngcontent-%COMP%]{margin-top:20px;background-color:#3880ff;color:#fff}.input-group-addon[_ngcontent-%COMP%]{display:flex;align-items:center}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),o})()}];let T=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.Bz.forChild(O),m.Bz]}),o})(),A=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.ez,h.u5,c.Pc,T]}),o})()}}]);